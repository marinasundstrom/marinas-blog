<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    
    <title>Marina Sundström</title>
    
    <meta name="description" content="Personal blog of Marina Sundström."/>
    <meta name="keywords" content="Blog, Personal, Software Development"/>

    <base href="/"/>
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet"/>
    <link href="css/app.css" rel="stylesheet"/>
    <link href="PersonalSite.styles.css" rel="stylesheet"/>

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png"/>
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png"/>
    <link rel="manifest" href="/site.webmanifest"/>
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/>
    <meta name="msapplication-TileColor" content="#da532c"/>
    <meta name="theme-color" content="#ffffff"/>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/vs.min.css"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/highlightjs-cshtml-razor/dist/cshtml-razor.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.7.0/highlightjs-line-numbers.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin=""/>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&amp;display=swap" rel="stylesheet"/>

    <script src="/js/scripts.js"></script>

    <style>
        .bd-placeholder-img {
          font-size: 1.125rem;
          text-anchor: middle;
          -webkit-user-select: none;
          -moz-user-select: none;
          user-select: none;
        }
  
        @media (min-width: 768px) {
          .bd-placeholder-img-lg {
            font-size: 3.5rem;
          }
        }
      </style>
    

<!-- %%-PRERENDERING-HEADOUTLET-BEGIN-%% -->
<title>The anatomy of an ASP.NET Core app - Marina Sundström</title>
<!-- %%-PRERENDERING-HEADOUTLET-END-%% -->
<script src="data:text/javascript;base64,KGZ1bmN0aW9uKG4sdCxpKXtmb3IodmFyIGY9bi5jcmVhdGVOb2RlSXRlcmF0b3IobiwxMjgpLHIsZSx1O2YubmV4dE5vZGUoKTspaWYocj1mLnJlZmVyZW5jZU5vZGUsdC50ZXN0KHIudGV4dENvbnRlbnQudHJpbSgpKSl7d2hpbGUoaT1yLm5leHRTaWJsaW5nKWlmKGU9aS50ZXh0Q29udGVudC50cmltKCksaS5yZW1vdmUoKSx0LnRlc3QoZSkpYnJlYWs7ci5yZW1vdmUoKTticmVha311PUFycmF5LmZyb20obi5xdWVyeVNlbGVjdG9yQWxsKCJzY3JpcHQiKSkucG9wKCk7dSYmdS5yZW1vdmUoKX0pKGRvY3VtZW50LC9eJSUtUFJFUkVOREVSSU5HLUhFQURPVVRMRVQtKEJFR0lOfEVORCktJSUkLyk7"></script></head>

<body>
    <div id="app" class="d-flex h-100">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%"></circle>
            <circle r="40%" cx="50%" cy="50%"></circle>
        </svg>
        <div class="loading-progress-text"></div>
    
<!-- %%-PRERENDERING-BEGIN-%% -->
<div style="opacity: 0; position: fixed; z-index: -1; top: 0; left: 0; bottom: 0; right: 0;">
    <div class="container d-flex w-100 h-100 mx-auto flex-column" style="padding-top: 110px !important;"><header><div><nav class="navbar navbar-expand-lg bg-brand navbar-dark fixed-top px-3"><div class="container"><a href="" class="navbar-brand mr-auto mr-lg-0"><img src="/images/profile.jpeg" alt="Profile Image" class="rounded-circle profile" style="margin-right: 10px; height: 32px; font-weight: 700">
        Marina Sundström</a>
    <button class="navbar-toggler p-0 border-0" type="button" data-toggle="offcanvas"><span class="navbar-toggler-icon"></span></button>

    <div class="navbar-collapse offcanvas-collapse " id="navbarsExampleDefault"><ul class="navbar-nav mr-auto"><li class="nav-item active"><a href="" class="nav-link">Home</a></li>
            <li class="nav-item active"><a href="/#who-am-i" class="nav-link">About me</a></li>
            <li class="nav-item"><a href="articles" class="nav-link active">Articles</a></li>
            <li class="nav-item"><a href="resume" class="nav-link">Resumé</a></li>
            <li class="nav-item"><a href="portfolio" class="nav-link">Portfolio</a></li></ul>
        <ol class="navbar-nav flex-row flex-wrap ms-md-auto list-inline list-unstyled" style="margin: 0;"><li class="nav-item list-inline-item"><a class="nav-link menu-link me-0 py-2 text-decoration-none text-uppercase" href="https://github.com/marinasundstrom" title="GitHub" target="_blank"><i class="fab fa-2x fa-github"></i></a></li>

            <li class="nav-item list-inline-item"><a class="nav-link menu-link me-0 py-2 text-decoration-none text-uppercase" href="https://www.youtube.com/channel/UCVdav9wE4kmtiEuk1_vG2_g" target="_blank"><i class="fab fa-2x fa-youtube"></i></a></li>

            <li class="nav-item list-inline-item"><a class="nav-link menu-link me-0 py-2 text-decoration-none text-uppercase" href="https://twitter.com/marna_li" title="Twitter" target="_blank"><i class="fab fa-2x fa-twitter"></i></a></li>

            <li class="nav-item list-inline-item"><a class="nav-link menu-link me-0 py-2 text-decoration-none text-uppercase" href="https://www.linkedin.com/in/marinasundstrom" title="LinkedIn" target="_blank"><i class="fab fa-2x fa-linkedin"></i></a></li>

            <li class="nav-item vr"></li>

            <li class="nav-item list-inline-item dropdown"><a class="nav-link menu-link me-0 py-2 dropdown-toggle" __internal_preventDefault_onclick __internal_stopPropagation_onclick href="#" id="navbarDarkDropdownMenuLink" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fas fa-2x fa-sun"></i></a>
                <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="navbarDarkDropdownMenuLink"><li><a class="dropdown-item" href="#" __internal_preventDefault_onclick><i class="fas fa-2x fa-sun"></i><span class="ms-2 fs-5">•</span></a></li>
                    <li><a class="dropdown-item" href="#" __internal_preventDefault_onclick><i class="fas fa-2x fa-moon"></i></a></li>
                    <li><a class="dropdown-item" href="#" __internal_preventDefault_onclick><i class="fas fa-2x fa-cog"></i></a></li></ul></li></ol></div></div></nav></div></header>

  <main><article class="post outer"><div class="inner container"><header b-76by154q0w><h1 class="post-title" b-76by154q0w>The anatomy of an ASP.NET Core app</h1><h2 class="post-subtitle" b-76by154q0w>Understanding the basic concepts</h2><div class="mt-2 mt-md-3" b-76by154q0w><div class="d-flex justify-content-between" b-76by154q0w><span b-76by154q0w><small class="mb-2 text-muted" b-76by154q0w><time datetime="2023-09-07" b-76by154q0w>7 Sep 2023</time> • 
                        11 minutes read

</small><small class="text-muted" b-76by154q0w> • </small><a class="badge rounded-pill tag me-1 mb-1 text-decoration-none" href="/articles/tags/.NET" b-76by154q0w>.NET</a><a class="badge rounded-pill tag me-1 mb-1 text-decoration-none" href="/articles/tags/ASP.NET%20Core" b-76by154q0w>ASP.NET Core</a><a class="badge rounded-pill tag me-1 mb-1 text-decoration-none" href="/articles/tags/Web%20development" b-76by154q0w>Web development</a><a class="badge rounded-pill tag me-1 mb-1 text-decoration-none" href="/articles/tags/Blazor" b-76by154q0w>Blazor</a><a class="badge rounded-pill tag me-1 mb-1 text-decoration-none" href="/articles/tags/Razor" b-76by154q0w>Razor</a></span><div b-76by154q0w><h4 class="badge bg-secondary comment-badge m-0"><span class="disqus-comment-count" data-disqus-url="http://127.0.0.1:5050/articles/the-anatomy-of-an-aspnetcore-app/">#</span></h4></div></div></div></header></div>

            <div class="mt-4 inner container"><h2 id="preface">Preface</h2>
<p>The goal of this article is to give someone who is new to ASP.NET Core an overview over the basic concepts of ASP.NET Core - by not going too much into technical details. Though, I will try to cover the essentials - Showing you the simplicity of the ASP.NET Core app model.</p>
<p>If you come from NodeJS, and you have been using ExpressJS, then you might find many of the concepts familiar.</p>
<p>Hopefully, you will find the examples useful in understanding what ASP.NET Core is about, and what you might be able to do with it.</p>
<p>I have included some links at the end, if you want to go deeper into the topics.</p>
<p><em>Parts of the article, specifically that about <em>Razor components</em>, is about the upcoming .NET 8. (To be released in November 2023)</em></p>
<h2 id="contents">Contents</h2>
<ol>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-1">What is ASP.NET Core?</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-2">Hello World!</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-3">Core concepts</a>
<ol>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-3-1">Application</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-3-2">HttpContext</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-3-3">Route handlers</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-3-4">Middleware</a></li>
</ol>
</li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-4">Razor components</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-5">Native AOT compilation</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-6">Conclusion</a></li>
<li><a href="/articles/the-anatomy-of-an-aspnetcore-app/#section-7">Links</a></li>
</ol>
<h2 id="section-1">What is ASP.NET Core?</h2>
<p>ASP.NET Core is a framework for building apps for the Web that run on the server, using .NET, and programming languages like C#. Running on the server means that it processes HTTP requests and produces HTTP responses.</p>
<p>The framework gives you the tools and abstractions to facilities the generation server-side rendered HTML pages using Razor syntax, as well as the creation of Web APIs, serving data in formats such as JSON.</p>
<p>Both .NET and ASP.NET Core is cross-platform, and runs on Windows, Mac and Linux. It is also open-source, being developed in the open by Microsoft with help from the community.</p>
<p>ASP.NET Core is also Web standards-compliant.</p>
<h2 id="section-2">Hello World!</h2>
<p>This is the simplest ASP.NET Core app that you can write (<code>Program.cs</code>):</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

var app = builder.Build();

app.MapGet("/hello", () =&gt; "Hello, World!");

app.Run();
</code></pre>
<p>This is the project file (<code>.csproj</code>):</p>
<pre><code class="language-xml">&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;

  &lt;PropertyGroup&gt;
    &lt;TargetFramework&gt;net8.0&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
  &lt;/PropertyGroup&gt;

&lt;/Project&gt;
</code></pre>
<p>To run the app:</p>
<pre><code class="language-sh">dotnet run
</code></pre>
<p>Then, view the page in your browser: <code>http://localhost:5000/</code></p>
<p>I don't think that I need to explain this code. It is a simple endpoint for <code>GET /hello</code> that returns a string .</p>
<p>All you need to do is to target the <code>Microsoft.NET.Sdk.Web</code>. No additional dependencies are required for this since this is built into .NET SDK.</p>
<p>The example above uses top-level statements, which is a feature that eliminates the ceremony of having to declare a <code>Main</code> method.</p>
<h2 id="section-3">Core concepts</h2><h2>
<p>This section is meant to give you a basic understanding of what an ASP.NET Core app looks like - the anatomy of an ASP.NET Core application, if you want.</p>
</h2><h3 id="section-3-1">Application</h3><h3>
<p>The <code>WebApplication</code> object is representing the application with what is needed to serve HTTP, and the <code>WebApplicationBuilder</code> is responsible for constructing that object. It sets up the basic dependencies for the app to work - the Web server.</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

// Add services to the builder

var app = builder.Build();

// Map endpoints, and/or add middleware.

app.Run();
</code></pre>
<p>The factory method <code>WebApplication.CreateBuilder</code> creates a builder that has default services added to it - such as the HTTP Server, and facilities for logging.</p>
<p>Once the <code>WebApplication</code> object has been created in your code, you can start mapping routes to handlers, and add middleware to the pipeline - to add some behavior.</p>
<p>And finally you can start the app, by calling <code>Run</code>.</p>
</h3><h4 id="dependency-injection">Dependency injection</h4>
<p>Dependency injection is built into ASP.NET Core. And it is with the builder that you register any dependencies that you want to go into the service container of the app.</p>
<p>If you want to enable, for instance Open API, then you have to add services that allow for that. Usually you are provided with handy extension methods that do all that hard work for you. These often take delegates that can be used to configure those services.</p>
<p>This is what dependency injection looks like when registering your own service:</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddScoped&lt;Dog&gt;();

var app = builder.Build();

app.MapGet("/give-treat", (string treat, Dog dog) =&gt; $"{dog.Name} got a {treat}!");

app.Run();

class Dog 
{
    public string Name =&gt; "Fido";
}
</code></pre>
<p>Hit the endpoint: <code>/give-treat?treat=snack</code>. The server responds with: <code>Fido got a snack</code>.</p>
<p>You see that services might be injected as parameters into any handler, next to bound parameters. The framework will try to figure out whether, or not, a class type is a bound parameter, or a service - based on what is in the service container.</p>
<p>The <code>AddScoped&lt;T&gt;()</code> adds a service to the service container with the scoped lifetime. In the ASP.NET Core context, that means that the same instance of type <code>T</code> is being resolved during the scope of the current HTTP request. When there is another request, a new instance is being created.</p>
<p>The frameworks makes some object available through dependency injection, including <code>HttpContext</code>, and both <code>HttpRequest</code> and <code>HttpResponse</code> separately. The ones mentioned are scoped.</p>
<h3 id="section-3-2">HttpContext</h3>
<p>Since ASP.NET Core is a server Web framework, it deals with HTTP. That means processing HTTP Requests and producing HTTP Responses.</p>
<p>In the world of ASP.NET Core, a Request and a Response are bound to what is called a <code>HttpContext</code>. This contains all the information pertaining to the request, as well as the object representing the response that will be returned. The response object can be modified.</p>
<p>You can get the request headers as well as information about the authenticated user. (If that has been enabled) Then you can modify the response, either from an route handler, or using middleware.</p>
<p>The current instance of <code>HttpContext</code> can be obtained through dependency injection - but it is only necessary when doing response manipulation, like modifying the response headers.</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

var app = builder.Build();

app.MapGet("/", async (HttpContext httpContext) =&gt; 
    await httpContext.Response.WriteAsync("Hello world"));

app.Run();
</code></pre>
<h3 id="section-3-3">Route handlers</h3>
<p>The perhaps most important part of your Web application is to handle requests that are being sent to specific routes in order to perform some operation, and then return a response with some result.</p>
<p>You can map a a specific path (or route) and HTTP verb, such as <code>GET</code> and <code>POST</code>, to a route handler using the <code>Map</code> (<code>MapGet</code>, <code>MapPost</code> etc) extension methods on the <code>WebApplication</code> object.</p>
<p>In software development, we often interchangeably refer to a route handler that handles a specific route as an <strong>Endpoint</strong>.</p>
<p>Sometimes you also might stumble on the term "Minimal API" endpoints in ASP.NET Core. That is simply a name for this feature.</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

var app = builder.Build();

// GET /
app.MapGet("/", () =&gt; "Hello, World!");

// GET /test?id=20
app.MapGet("/test", (int id) =&gt; $"The Id is: {id}");

// GET /foo?value=42 - Returns: { "Value": 42 }
app.MapGet("/foo", (int value) =&gt; new FooResult(value));

// GET /items/foo
app.MapGet("/items/{id}", (string id) =&gt;  $"Item Id: {id}");

// POST /greet (JSON Body: { "name": "Bob" } )
app.MapPost("/greet", (GreetingRequest request) =&gt; $"Hello, {request.Name}!");

app.Run();

public record FooResult(int Value);

public record GreetingRequest(string Name);
</code></pre>
<h4 id="parameter-binding">Parameter binding</h4>
<p>As demonstrated above, you can bind query strings and request bodies to parameters. Even inject services as parameters, as seen before. And you can return both primitive values and complex objects, as well as results that modify the response and its status code.</p>
<p>And worth noting that the default serialization format is JSON.</p>
<p>Before the route handlers, middleware might be executed. We will have a look at Middlware later in this article.</p>
<h4 id="result-types">Result types</h4>
<p>A route handler might return a specific result object that modifies the response, its status code, and content. Examples of this is emitting a response with a status code like <code>400 BadRequest</code>, or <code>201 Created</code>, or for sending a file.</p>
<p>The <code>TypedResults</code> factory class contains static methods for creating these result objects:</p>
<pre><code class="language-csharp">using Microsoft.AspNetCore.Http.HttpResults;

var builder = WebApplication.CreateBuilder(args);

var app = builder.Build();

// GET /?number=20
app.MapGet("/", Results&lt;Ok&lt;string&gt;, BadRequest&gt; (int number) =&gt; 
{
    if(number &gt; 10) 
    {
        return TypedResults.BadRequest();
    }

    return TypedResults.Ok($"The number is: {number}");
});

app.Run();
</code></pre>
<p>Note that we can specify the return type for the lambda expression: <code>Results&lt;Ok&lt;int&gt;, BadRequest&gt;</code>.</p>
<p>The type <code>Results&lt;TResult1,TResult2&gt;</code> acts as a discriminated union that makes it explicit what results the endpoint can and may return.</p>
<p>Using result types will make your endpoints type-safe, and aid when generating Open API specifications (Swagger) - if that has been enabled.</p>
<h5 id="bonus-improve-readability">Bonus: Improve readability</h5>
<p>To simplify and improve readability of your code, you can import the static members of <code>TypedResult</code>, that is, the factory methods, into the current scope - like so:</p>
<pre><code class="language-csharp">using static Microsoft.AspNetCore.Http.TypedResults;

// Code omitted

app.MapGet("/helloworld", Results&lt;Ok&lt;string&gt;, BadRequest&gt; () =&gt; 
{
    // Equivalent to: TypedResults.Ok()

    return Ok("Hello, World"!);
});
</code></pre>
<h4 id="filters">Filters</h4>
<p>A filter is a piece of code that runs after the route, or endpoint, has been resolved, but before the route handler has been invoked.</p>
<p>Filters allow you to intercept, access parameters, and do some manipulation. The reasons for intercepting an endpoint might be logging, or validation of data.</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

var app = builder.Build();

string ColorName(string color) =&gt; $"Color specified: {color}!";

app.MapGet("/colorSelector/{color}", ColorName)
    .AddEndpointFilter(async (invocationContext, next) =&gt;
    {
        var color = invocationContext.GetArgument&lt;string&gt;(0);

        if (color == "Red")
        {
            return Results.Problem("Red not allowed!");
        }
        return await next(invocationContext);
    });

app.Run();
</code></pre>
<p>Filters are similar to Middleware (next section) but differ in that they act on the endpoint, while middleware act on the request, before the endpoint is resolved.</p>
<p>You can chain filters to an endpoint. They will be executed in the order if First In, Last Out (FIFO), before invoking the route handler.</p>
<p>You can make endpoint filers re-usable by putting them into their own classes that implement <code>IEndpointFilter</code>.</p>
<h3 id="section-3-4">Middleware</h3>
<p>The purpose of middleware is to process a request and to modify the response. They are placed in a pipeline, and executed before the actual route handler.</p>
<p>Using middleware we extend our web apps with additional functionality, such as Response Compression, and Open API/Swagger support.</p>
<p>For example, the Response Compression middleware compresses a response. It can be added to the container, and then the Web App, using extension methods.</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

builder.Services.AddResponseCompression();

var app = builder.Build();

app.UseResponseCompression();

app.MapGet("/", () =&gt; "Hello World!");

app.Run();
</code></pre>
<p>As seen above, middleware can be dependant on specific services. Extension methods like <code>AddResponseCompression</code>, are convenient for making your code cleaner by hiding away service registration as well as middleware stuff.</p>
<p>As mentioned, middleware are in a pipeline, so they are executed in the order that they have been added to that pipeline. And when a middleware has executed it returns to the previous middleware, this allows it to execute logic afterwards. <em>(See example below)</em></p>
<p>You can define custom middleware delegates like so:</p>
<pre><code class="language-csharp">var builder = WebApplication.CreateBuilder(args);

var app = builder.Build();

app.Use(async (context, next) =&gt;
{
    // Do work that can write to the Response.

    Console.WriteLine("Start");

    await next.Invoke();

    // Do logging or other work that doesn't write to the Response.

     Console.WriteLine("End");
});

app.Use(async (context, next) =&gt;
{
    Console.WriteLine("Foo");

    await next.Invoke();

    Console.WriteLine("Bar");
});

app.MapGet("/hello", () =&gt; "Hello, World!");

app.Run();
</code></pre>
<p>This is what it will look like when invoking <code>/hello</code>:</p>
<pre><code class="language-sh">Start
Foo
"/hello" route handler
Bar
End
</code></pre>
<p>You can also define middleware as a class, and add it to the pipeline using the <code>UseMiddleware&lt;T&gt;()</code> method.</p>
<h2 id="section-4">Razor components</h2><h2>
<p><em>This section is about things coming in .NET 8. (To be released in November 2023)</em></p>
<p>Razor components are components written in the Razor syntax, which is a templating language that combines HTML and C# code in order to dynamically generate web pages. It basically is for .NET what JSX is to React - but not really.</p>
<p>Consider this <code>HelloWorld.razor</code> component:</p>
<pre><code class="language-razor">&lt;h1&gt;@title&lt;/h1&gt;

&lt;ul&gt;
@foreach(var item in items) 
{
    &lt;li&gt;@item.Name&lt;/li&gt;
}
&lt;/ul&gt;

@code 
{
    string title = "Hello, World!";
    List&lt;Item&gt; items = new List&lt;Item&gt;();

    protected override void OnInitialized()
    {
        items.Add(new Item("A"));
        items.Add(new Item("B"));
    }

    public record Item(string Name);
}
</code></pre>
<p>The Razor templating language is named for its <code>@</code> character (at-symbol) which signifies the start of C# code. The tooling is quite smart about that when compiling the template into C#.</p>
<p>And as you might have noticed, Razor components live in files with the <code>.razor</code> extension.</p>
<p>You can return a Razor component from an endpoint using the <code>RazorComponentResult</code> result type:</p>
<pre><code class="language-csharp">using TestApp1;
using Microsoft.AspNetCore.Http.HttpResults;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorComponents();

var app = builder.Build();

app.Map("/helloworld", () =&gt; new RazorComponentResult&lt;HelloWorld&gt;());

app.Run();
</code></pre>
<p>Upon navigating to <code>/helloworld</code> this will be rendered:</p>
<pre><code class="language-html">&lt;h1&gt;Hello, World!&lt;/h1&gt;

&lt;ul&gt;
    &lt;li&gt;A&lt;/li&gt;
    &lt;li&gt;B&lt;/li&gt;
&lt;/ul&gt;
</code></pre>
</h2><h3 id="interactive-components">Interactive components</h3>
<p>Although Razor components are server-side rendered by default, you can make them interactive. You can build an entire interactive SPA (Single-page application) with routable pages if you so want.</p>
<p>Interactive apps are more commonly known as Blazor apps. Blazor is the product name. Though the name dates back to the early prototype.</p>
<p>With Blazor, you basically get the choice of running the component on the server, or in the browser using WebAssembly. These are called <em>Render modes</em>.</p>
<p>This is how you set up simple app with one routable interactive component: <code>Counter</code>.</p>
<p>The <code>App.razor</code> is the root component of the page:</p>
<pre><code class="language-razor">@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web

&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;

&lt;head&gt;
    &lt;meta charset="utf-8" /&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" /&gt;
    &lt;meta http-equiv="refresh" content="3600"&gt;
    &lt;base href="/" /&gt;
    &lt;!-- &lt;link rel="stylesheet" href="TestApp1.styles.css" /&gt; --&gt;
    &lt;HeadOutlet /&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;CascadingAuthenticationState&gt;
        &lt;Router AppAssembly="@typeof(App).Assembly"&gt;
            &lt;Found Context="routeData"&gt;
                &lt;RouteView RouteData="@routeData"&gt;&lt;/RouteView&gt;
                &lt;FocusOnNavigate RouteData="@routeData" Selector="h1" /&gt;
            &lt;/Found&gt;
        &lt;/Router&gt;
    &lt;/CascadingAuthenticationState&gt;

    &lt;script src="_framework/blazor.web.js" suppress-error="BL9992"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>Here is the <code>Counter.razor</code> page component:</p>
<pre><code class="language-razor">@using Microsoft.AspNetCore.Components.Web
@page "/"
@attribute [RenderModeServer]

&lt;PageTitle&gt;Counter&lt;/PageTitle&gt;

&lt;p role="status"&gt;Current count: @currentCount&lt;/p&gt;

&lt;button class="btn btn-primary" @onclick="IncrementCount"&gt;Click me&lt;/button&gt;

@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }
}
</code></pre>
<p>The <code>@page</code> directive tells the router that this component is a page with a specific route: <code>/</code>.</p>
<p>The initialization in <code>Program.cs</code> is a bit different because the app will itself make sure to find the page components and register endpoints for them. And also, we enable interactivity with the Server render mode.</p>
<pre><code class="language-csharp">using TestApp1;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddRazorComponents()
    .AddServerComponents();
    
var app = builder.Build();

app.UseStaticFiles();

app.MapRazorComponents&lt;App&gt;()
    .AddServerRenderMode();

app.Run();
</code></pre>
<p>When navigating to <code>/</code> in your browser, this will happen:</p>
<p>The component will show up in your browser. Set up a WebSocket connection to the server where the component will run - the reason for the script.</p>
<p>When you click the button, the <code>IncrementCount</code>method will be invoked on the server, and increase the value of the <code>currentCount</code> field by 1. The UI will then be updated to reflect that change of state.</p>
<p>What makes a difference is the <code>@attribute [RenderModeServer]</code>, and the little piece of JS script that activates interactivity in the browser.</p>
<h2 id="section-5">Native AOT compilation</h2>
<p>ASP.NET Core 8 does support Ahead-of-Time (AOT) compilation scenarios when those are needed. Meaning that you can compile an app to native machine code - but it is not for everyone.</p>
<p>The framework is giving you ways to do stuff that is not reliant on Reflection. And by only including what is only necessary to run the app, you get a small app. The drawback is that you as a developer have to add stuff back manually - which might be fine if you have the concerns that AOT is supposed to solve.</p>
<p>When you are serializing JSON, you instead will use source generators to generate the C# code that parses and map JSON to objects at compile-time - because Reflection is not supported in native AOT code.</p>
<p>This is why AOT really is not for every app.</p>
<p>Because .NET 8 and ASP.NET Core already are well-optimized, you most likely never have go down this route when building a normal Web application. You might not gain anything significant from going AOT, compared to the effort put in.</p>
<h2 id="section-6">Conclusion</h2>
<p>This concludes this article about the basic anatomy of an ASP.NET Core.</p>
<p>If you want to learn more, then I recommend you to check out the links below.</p>
<h2 id="section-7">Links</h2>
<p>These are links to the official documentation at Microsoft Learn:</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/?view=aspnetcore-8.0">ASP.NET Core documentation</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-8.0">Dependency injection in ASP.NET Core</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/use-http-context?view=aspnetcore-8.0">Use HttpContext in ASP.NET Core</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/minimal-apis?view=aspnetcore-8.0">Minimal APIs quick reference</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/middleware/?view=aspnetcore-8.0">ASP.NET Core Middleware</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/components/?view=aspnetcore-8.0">ASP.NET Core Razor components</a></li>
<li><a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/native-aot?view=aspnetcore-8.0">ASP.NET Core support for native AOT</a></li>
</ul>
<div style="margin-top: 42px;"><div id="disqus_thread"></div></div></div></article></main>

  <footer class="pt-3 pb-3 px-4 my-5 mx-auto w-100 container text-center"><small class="text-muted">© 2023 Marina Sundström | Built with .NET & Blazor - Hosted by GitHub Pages</small></footer></div>
        



</div>
<!-- %%-PRERENDERING-END-%% -->
</div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">🗙</a>
    </div>
    
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="_content/Blazor-Analytics/blazor-analytics.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>
  


</body></html>